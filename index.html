<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0a0a0a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FlickIt">
<meta name="description" content="Realistic Zippo lighter simulator â€” flame physics, smoke, mic blow detection, concert mode.">
<title>FlickIt â€“ Virtual Lighter</title>

<!-- PWA Manifest inline as base64 -->
<link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiRmxpY2tJdCDigJMgVmlydHVhbCBMaWdodGVyIiwic2hvcnRfbmFtZSI6IkZsaWNrSXQiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTBhMGEiLCJ0aGVtZV9jb2xvciI6IiMwYTBhMGEiLCJvcmllbnRhdGlvbiI6InBvcnRyYWl0IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIQnlaWE5sY25abFFYTndaV04wVW1GMGFXODlJbmhOYVc1WlRXbHVJRzFsWlhRaUlIWnBaWGRDYjNnOUlqQWdNQ0F4TmpBZ01UWXdJajQ4Y21WamRDQjNhV1IwYUQwaU1UWXdJaUJvWldsbmFIUTlJakUyTUNJZ1ptbHNiRDBpSTBVd1JUQWlJSEpsY0c5eWRHbHZiajBpZUUxaGJpd2dkbUZ5WVhraUlEeHlaV04wSUhkcFpIUm9QU0l4TmpBaUlHaGxhV2RvZEQwaU1UWXdJaUJ6ZEhsc1pUMGliV0ZqYUc4dVpHVm1ZWFZzZERzaUlERXdNREE4TDNKbFkzUStQQzl6ZG1jKyIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwic2l6ZXMiOiIxNjB4MTYwIn1dfQ==">

<style>
/* =====================================================
   CSS CUSTOM PROPERTIES
   ===================================================== */
:root {
  --bg:         #0a0a0a;
  --text:       #e2e2e2;
  --dim:        #666;
  --accent:     #ff6a00;
  --accent2:    #ee0979;
  --gold:       #c9a84c;
  --glow:       rgba(255,140,30,.55);
  --metal-hi:   #f0f0f0;
  --safe-top:   env(safe-area-inset-top, 0px);
  --safe-bot:   env(safe-area-inset-bottom, 0px);
}

/* =====================================================
   RESET
   ===================================================== */
*,*::before,*::after { box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; }
html,body {
  width:100%; height:100%; overflow:hidden;
  background:var(--bg); color:var(--text);
  font-family:'Helvetica Neue',Helvetica,sans-serif;
  touch-action:none;            /* disable ALL default touch handling â€” JS owns it */
  user-select:none; -webkit-user-select:none;
}

/* =====================================================
   APP SHELL
   ===================================================== */
#app {
  position:fixed; inset:0;
  display:flex; flex-direction:column; align-items:center;
  overflow:hidden;
}
#app::before {
  content:''; position:absolute; inset:0;
  background:
    radial-gradient(ellipse 60% 40% at 50% 85%, rgba(255,100,0,.07) 0%,transparent 70%),
    radial-gradient(ellipse 80% 50% at 50% 10%, rgba(20,20,40,.9) 0%,transparent 80%),
    linear-gradient(175deg,#0d0d0d 0%,#090909 60%,#0c0808 100%);
  pointer-events:none; z-index:0;
}

/* =====================================================
   CANVAS
   ===================================================== */
#fc {
  position:absolute; inset:0; width:100%; height:100%;
  pointer-events:none; z-index:2;
}

/* =====================================================
   TOP BAR
   ===================================================== */
#topbar {
  position:relative; z-index:10;
  width:100%; max-width:430px;
  display:flex; align-items:center; justify-content:space-between;
  padding:calc(14px + var(--safe-top)) 20px 8px;
  flex-shrink:0;
}
.app-title {
  font-family:Georgia,'Times New Roman',serif;
  font-size:23px; letter-spacing:3.5px;
  color:var(--metal-hi);
  text-shadow:0 0 22px rgba(255,160,40,.5);
}
.app-title span { color:var(--accent); }
.bg { display:flex; gap:8px; }
.ib {
  width:40px; height:40px; border-radius:11px;
  border:1.5px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.04); color:var(--dim);
  font-size:18px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition:background .15s,transform .1s;
}
.ib:active { background:rgba(255,255,255,.12); transform:scale(.9); }
.ib.on { color:#ff44cc; border-color:#ff44cc; box-shadow:0 0 14px #ff44cc55; }

/* =====================================================
   COUNTER BAR
   ===================================================== */
#cbar {
  position:relative; z-index:10;
  width:100%; max-width:430px;
  display:flex; align-items:center; justify-content:center; gap:28px;
  padding:2px 20px 8px; flex-shrink:0;
}
.ci { text-align:center; }
.cv {
  font-size:22px; font-weight:800; color:var(--accent);
  text-shadow:0 0 12px var(--accent);
  transition:transform .15s;
}
.cv.bump { transform:scale(1.4); }
.cl { font-size:9px; letter-spacing:1.8px; color:var(--dim); text-transform:uppercase; }
.cd { width:1px; height:30px; background:rgba(255,255,255,.08); }

/* =====================================================
   LIGHTER AREA
   ===================================================== */
#la {
  position:relative; z-index:5;
  display:flex; flex-direction:column; align-items:center;
  margin-top:auto;
  padding-bottom:calc(8px + var(--safe-bot));
  width:100%; max-width:430px; flex-shrink:0;
}

/* color dots */
#cbar2 { display:flex; align-items:center; gap:10px; margin-bottom:12px; }
.cdot {
  width:26px; height:26px; border-radius:50%; cursor:pointer;
  border:2.5px solid transparent; position:relative; overflow:hidden;
  transition:transform .2s,border-color .2s;
}
.cdot.on { border-color:#fff; transform:scale(1.18); }
.cdot .lm {
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.55); border-radius:50%; font-size:11px;
}
#co { background:radial-gradient(circle,#ffcc00,#ff3300); }
#cb { background:radial-gradient(circle,#88ccff,#0033cc); }
#cg { background:radial-gradient(circle,#aaff44,#005500); }
#cp { background:radial-gradient(circle,#dd88ff,#440099); }
#cr { background:radial-gradient(circle,#ff9999,#cc0000); }

/* skin bar */
#sbar { display:flex; align-items:center; gap:11px; margin-bottom:14px; }
.st {
  width:46px; height:46px; border-radius:11px; cursor:pointer;
  border:2px solid transparent; position:relative; overflow:hidden;
  transition:all .2s;
}
.st.on { border-color:var(--accent); box-shadow:0 0 14px var(--accent); }
.st .sl {
  position:absolute; inset:0; background:rgba(0,0,0,.52);
  display:flex; align-items:center; justify-content:center; font-size:16px;
}
#s0 { background:linear-gradient(135deg,#c0c0c0,#808080,#e8e8e8,#606060); }
#s1 { background:linear-gradient(135deg,#c9a84c,#7a5c1e,#e8cc6a,#9a7c3a); }
#s2 { background:linear-gradient(135deg,#00ffcc,#0044ff,#ff00cc,#6600ff); }
#s3 { background:linear-gradient(135deg,#8b0000,#ff4400,#2a0000,#cc2200); }

/* lighter container */
#lc {
  position:relative; width:158px; height:264px; cursor:pointer;
  filter:drop-shadow(0 22px 44px rgba(0,0,0,.85));
  transition:filter .3s;
}
#lc.glow {
  filter:
    drop-shadow(0 22px 44px rgba(0,0,0,.85))
    drop-shadow(0 0 32px var(--glow))
    drop-shadow(0 0 64px rgba(255,110,0,.25));
}
#ls { width:100%; height:100%; overflow:visible; display:block; }

#lid {
  transform-origin:79px 109px;
  transition:transform .38s cubic-bezier(.34,1.56,.64,1);
  will-change:transform;
}
#lid.open { transform:rotate(-108deg); }

/* cigarette */
#cigrow {
  margin-top:12px; display:flex; align-items:center; gap:12px;
  opacity:0; transition:opacity .45s; pointer-events:none;
}
#cigrow.vis { opacity:1; pointer-events:auto; }
#cigw { cursor:pointer; }
#cigw:active { opacity:.85; }
.ciglbl { font-size:10px; letter-spacing:1.2px; color:var(--dim); text-transform:uppercase; }

/* hint */
#hint {
  font-size:11px; letter-spacing:1.6px; color:var(--dim); text-transform:uppercase;
  text-align:center; margin-top:13px; min-height:16px; transition:opacity .3s;
}

/* ad banner */
#adb {
  width:100%; max-width:430px; height:52px;
  background:rgba(255,255,255,.025);
  border-top:1px solid rgba(255,255,255,.06);
  display:flex; align-items:center; justify-content:center;
  font-size:11px; letter-spacing:1px; color:rgba(255,255,255,.18);
  flex-shrink:0; position:relative; z-index:10;
}

/* =====================================================
   SHARE BTN
   ===================================================== */
#shb {
  position:fixed; bottom:calc(65px + var(--safe-bot)); right:18px; z-index:12;
  width:46px; height:46px; border-radius:13px;
  background:rgba(255,255,255,.05); border:1.5px solid rgba(255,255,255,.1);
  color:var(--dim); font-size:18px;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition:all .15s;
}
#shb:active { background:rgba(255,255,255,.12); transform:scale(.92); }

/* =====================================================
   CONCERT OVERLAY
   ===================================================== */
#co2 { position:fixed; inset:0; z-index:1; pointer-events:none; opacity:0; transition:opacity .5s; }
#co2.on { opacity:1; }

/* =====================================================
   TOAST
   ===================================================== */
#toast {
  position:fixed; bottom:calc(72px + var(--safe-bot)); left:50%;
  transform:translateX(-50%) translateY(12px);
  background:rgba(22,22,22,.96); border:1px solid rgba(255,255,255,.1);
  border-radius:11px; padding:10px 20px; font-size:13px; color:var(--text);
  opacity:0; transition:opacity .28s,transform .28s;
  z-index:400; white-space:nowrap; pointer-events:none;
}
#toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* =====================================================
   SPARK FX
   ===================================================== */
@keyframes spk {
  0%   { transform:scale(0) rotate(0deg);    opacity:1; }
  60%  { transform:scale(2.8) rotate(70deg); opacity:.7; }
  100% { transform:scale(4) rotate(120deg);  opacity:0; }
}
.sfx {
  position:absolute; right:4px; top:44%;
  width:28px; height:28px; pointer-events:none; z-index:30;
  animation:spk .42s ease-out forwards;
  font-size:20px; color:#ffcc00;
  display:flex; align-items:center; justify-content:center;
}

/* =====================================================
   PANELS
   ===================================================== */
.panel {
  position:fixed; inset:0; z-index:200;
  background:rgba(0,0,0,.88); backdrop-filter:blur(14px);
  -webkit-backdrop-filter:blur(14px);
  display:none; align-items:center; justify-content:center; padding:24px;
}
.panel.open { display:flex; }
.pc {
  background:#141414; border:1px solid rgba(255,255,255,.09);
  border-radius:22px; padding:28px 24px;
  width:100%; max-width:390px;
  position:relative; max-height:85vh; overflow-y:auto;
}
.pt {
  font-family:Georgia,serif; font-size:20px; letter-spacing:2.5px;
  color:var(--metal-hi); text-align:center; margin-bottom:20px;
}
.pclose {
  position:absolute; top:16px; right:16px; width:34px; height:34px;
  background:rgba(255,255,255,.07); border:none; border-radius:9px;
  color:var(--text); font-size:16px; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.srow {
  display:flex; justify-content:space-between; align-items:center;
  padding:12px 0; border-bottom:1px solid rgba(255,255,255,.055);
}
.srow:last-of-type { border-bottom:none; }
.slbl { font-size:13px; color:var(--dim); }
.sval { font-size:18px; font-weight:700; color:var(--accent); }
.skcard { display:flex; align-items:center; gap:14px; padding:12px 0; border-bottom:1px solid rgba(255,255,255,.055); }
.skprev { width:50px; height:50px; border-radius:13px; flex-shrink:0; }
.skinfo .sn { font-size:14px; font-weight:600; }
.skinfo .sp { font-size:11px; color:var(--gold); margin-top:3px; }
.brow { display:flex; gap:10px; margin-top:16px; }
.btn {
  flex:1; padding:13px 0; border-radius:13px; border:none;
  font-size:13px; font-weight:600; cursor:pointer; letter-spacing:.4px;
  transition:opacity .15s,transform .1s;
}
.btn:active { opacity:.8; transform:scale(.96); }
.bpri { background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; }
.bsec { background:rgba(255,255,255,.07); color:var(--text); }
.bgld { background:linear-gradient(135deg,var(--gold),#7a5c1e); color:#fff; }
.bdan { background:rgba(200,0,0,.25); color:#ff6666; }
.bbuy { flex:none; padding:9px 15px; border-radius:9px; font-size:12px; }

/* =====================================================
   MIC PROMPT
   ===================================================== */
#mp {
  position:fixed; inset:0; z-index:300;
  background:rgba(0,0,0,.9); backdrop-filter:blur(12px);
  display:none; flex-direction:column; align-items:center; justify-content:center; padding:28px;
}
#mp.open { display:flex; }
.mpc {
  background:#161616; border:1px solid rgba(255,255,255,.1);
  border-radius:22px; padding:30px 24px;
  width:100%; max-width:340px; text-align:center;
}
.mpi { font-size:54px; margin-bottom:14px; }
.mpt { font-size:19px; font-weight:700; margin-bottom:8px; }
.mpb { font-size:13px; color:var(--dim); line-height:1.65; margin-bottom:22px; }

/* =====================================================
   INTERSTITIAL
   ===================================================== */
#inter {
  position:fixed; inset:0; z-index:350;
  background:rgba(0,0,0,.93);
  display:none; flex-direction:column; align-items:center; justify-content:center; padding:32px;
}
#inter.open { display:flex; }
.abox {
  width:100%; max-width:360px; height:260px; border-radius:18px;
  background:linear-gradient(135deg,#141428,#0f2040,#0a3050);
  border:1px solid rgba(255,255,255,.09);
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px;
  margin-bottom:22px;
}
.aico { font-size:52px; }
.atxt { font-size:13px; color:var(--dim); letter-spacing:1px; }
.asub { font-size:11px; color:rgba(255,255,255,.25); margin-top:4px; }
#skipAd {
  background:rgba(255,255,255,.09); border:1px solid rgba(255,255,255,.18);
  color:var(--text); padding:13px 36px; border-radius:11px; font-size:14px; cursor:pointer;
}
#skipAd:active { background:rgba(255,255,255,.18); }

/* =====================================================
   INSTALL BANNER
   ===================================================== */
#ib {
  position:fixed; top:0; left:0; right:0; z-index:500;
  background:#1a1a1a; border-bottom:1px solid rgba(255,200,0,.18);
  padding:13px 16px; display:none; align-items:center; gap:12px;
}
#ib.show { display:flex; }
.ibtxt { flex:1; font-size:13px; color:var(--dim); }
.ibtxt strong { color:var(--accent); }
#ibyes { padding:9px 15px; border-radius:9px; background:var(--accent); color:#fff; border:none; font-size:13px; cursor:pointer; }
#ibno  { padding:9px 13px; border-radius:9px; background:transparent; color:var(--dim); border:1px solid rgba(255,255,255,.1); font-size:12px; cursor:pointer; }
</style>
</head>
<body>

<div id="co2"></div><!-- concert overlay -->

<div id="app">

  <!-- TOP BAR -->
  <div id="topbar">
    <div class="app-title">Flick<span>It</span></div>
    <div class="bg">
      <button class="ib" id="conBtn" title="Concert Mode">ğŸµ</button>
      <button class="ib" id="statBtn" title="Stats">ğŸ“Š</button>
      <button class="ib" id="setBtn"  title="Settings">âš™ï¸</button>
    </div>
  </div>

  <!-- COUNTER BAR -->
  <div id="cbar">
    <div class="ci"><div class="cv" id="ctd">0</div><div class="cl">Today</div></div>
    <div class="cd"></div>
    <div class="ci"><div class="cv" id="ctt">0</div><div class="cl">Total</div></div>
    <div class="cd"></div>
    <div class="ci"><div class="cv" id="cts">0</div><div class="cl">Streak ğŸ”¥</div></div>
  </div>

  <!-- CANVAS -->
  <canvas id="fc"></canvas>

  <!-- LIGHTER AREA -->
  <div id="la">

    <!-- Flame color dots -->
    <div id="cbar2">
      <div class="cdot on" id="co" data-c="orange"></div>
      <div class="cdot"    id="cb" data-c="blue"></div>
      <div class="cdot"    id="cg" data-c="green">  <div class="lm">ğŸ”’</div></div>
      <div class="cdot"    id="cp" data-c="purple"> <div class="lm">ğŸ”’</div></div>
      <div class="cdot"    id="cr" data-c="red">    <div class="lm">ğŸ”’</div></div>
    </div>

    <!-- Skin bar -->
    <div id="sbar">
      <div class="st on" id="s0" data-s="chrome"></div>
      <div class="st"    id="s1" data-s="gold">   <div class="sl">ğŸ”’</div></div>
      <div class="st"    id="s2" data-s="neon">   <div class="sl">ğŸ”’</div></div>
      <div class="st"    id="s3" data-s="dragon"> <div class="sl">ğŸ”’</div></div>
    </div>

    <!-- Lighter SVG -->
    <div id="lc">
      <svg id="ls" viewBox="0 0 160 280" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="gB" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#222"/><stop offset="12%" stop-color="#5a5a5a"/>
            <stop offset="28%"  stop-color="#c8c8c8"/><stop offset="50%" stop-color="#f2f2f2"/>
            <stop offset="72%"  stop-color="#b8b8b8"/><stop offset="88%" stop-color="#505050"/>
            <stop offset="100%" stop-color="#222"/>
          </linearGradient>
          <linearGradient id="gL" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#181818"/><stop offset="14%" stop-color="#484848"/>
            <stop offset="32%"  stop-color="#aaa"/><stop offset="50%" stop-color="#dedede"/>
            <stop offset="68%"  stop-color="#9a9a9a"/><stop offset="86%" stop-color="#404040"/>
            <stop offset="100%" stop-color="#181818"/>
          </linearGradient>
          <linearGradient id="gW" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%"   stop-color="#9b6e42"/><stop offset="35%" stop-color="#6b3f2a"/>
            <stop offset="65%"  stop-color="#a87648"/><stop offset="100%" stop-color="#5a3020"/>
          </linearGradient>
          <linearGradient id="gH" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#2a2a2a"/><stop offset="50%" stop-color="#b0b0b0"/>
            <stop offset="100%" stop-color="#2a2a2a"/>
          </linearGradient>
          <linearGradient id="gT" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#252525"/><stop offset="50%" stop-color="#909090"/>
            <stop offset="100%" stop-color="#252525"/>
          </linearGradient>
          <linearGradient id="gBot" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%"   stop-color="#505050"/><stop offset="100%" stop-color="#181818"/>
          </linearGradient>
          <linearGradient id="gSh" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%"   stop-color="rgba(255,255,255,.65)"/>
            <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
          </linearGradient>
          <pattern id="pL" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse">
            <line x1="0" y1="5" x2="10" y2="5" stroke="rgba(0,0,0,.12)" stroke-width=".6"/>
          </pattern>
        </defs>

        <!-- BODY -->
        <rect x="20" y="108" width="120" height="158" rx="6" fill="url(#gB)"/>
        <rect x="20" y="108" width="120" height="158" rx="6" fill="url(#pL)" opacity=".7"/>
        <rect x="20" y="108" width="9"   height="158" rx="3" fill="rgba(0,0,0,.28)"/>
        <rect x="131" y="108" width="9"  height="158" rx="3" fill="rgba(0,0,0,.28)"/>
        <rect x="36" y="112" width="3.5" height="150" rx="1.5" fill="url(#gSh)" opacity=".75"/>
        <!-- Wood inlay -->
        <rect x="34" y="132" width="92" height="98" rx="3" fill="url(#gW)"/>
        <line x1="34" y1="147" x2="126" y2="147" stroke="rgba(0,0,0,.18)" stroke-width="1"/>
        <line x1="34" y1="157" x2="126" y2="157" stroke="rgba(0,0,0,.12)" stroke-width=".6"/>
        <line x1="34" y1="168" x2="126" y2="168" stroke="rgba(0,0,0,.18)" stroke-width="1"/>
        <line x1="34" y1="180" x2="126" y2="180" stroke="rgba(0,0,0,.1)"  stroke-width=".6"/>
        <line x1="34" y1="192" x2="126" y2="192" stroke="rgba(0,0,0,.18)" stroke-width="1"/>
        <line x1="34" y1="204" x2="126" y2="204" stroke="rgba(0,0,0,.1)"  stroke-width=".6"/>
        <line x1="34" y1="216" x2="126" y2="216" stroke="rgba(0,0,0,.18)" stroke-width="1"/>
        <rect x="34" y="132" width="92" height="98" rx="3" fill="none" stroke="rgba(0,0,0,.38)" stroke-width="1.5"/>
        <text x="80" y="176" text-anchor="middle" font-family="Georgia,serif" font-size="9.5" fill="rgba(255,215,140,.65)" letter-spacing="3">FLICKIT</text>
        <text x="80" y="189" text-anchor="middle" font-family="Georgia,serif" font-size="6"   fill="rgba(255,200,100,.35)" letter-spacing="1.5">EST. 2025</text>
        <!-- Bottom -->
        <rect x="22" y="260" width="116" height="7" rx="3.5" fill="url(#gBot)"/>
        <circle cx="34"  cy="263" r="3" fill="#1e1e1e"/><circle cx="34"  cy="263" r="1.4" fill="#555"/>
        <circle cx="126" cy="263" r="3" fill="#1e1e1e"/><circle cx="126" cy="263" r="1.4" fill="#555"/>
        <!-- Hinge -->
        <rect x="71" y="104" width="18" height="9" rx="3" fill="url(#gH)"/>
        <rect x="73" y="105" width="14" height="7" rx="2" fill="rgba(255,255,255,.14)"/>
        <!-- Chimney -->
        <rect x="52" y="88" width="56" height="22" rx="4" fill="url(#gT)"/>
        <rect x="54" y="90" width="52" height="18" rx="3" fill="rgba(0,0,0,.55)"/>
        <rect x="56" y="92" width="48" height="14" rx="2" fill="#0d0d0d"/>
        <ellipse cx="80" cy="92" rx="15" ry="3" fill="#090909"/>
        <rect x="58" y="94" width="4" height="11" rx="2" fill="rgba(255,255,255,.1)"/>

        <!-- LID GROUP -->
        <g id="lid">
          <rect x="20" y="18" width="120" height="91" rx="6" fill="url(#gL)"/>
          <rect x="20" y="18" width="120" height="91" rx="6" fill="url(#pL)" opacity=".5"/>
          <rect x="20" y="18" width="9"   height="91" rx="3" fill="rgba(0,0,0,.22)"/>
          <rect x="131" y="18" width="9"  height="91" rx="3" fill="rgba(0,0,0,.22)"/>
          <rect x="36" y="22" width="3.5" height="83" rx="1.5" fill="url(#gSh)" opacity=".65"/>
          <ellipse cx="80" cy="18" rx="60" ry="7.5" fill="url(#gL)"/>
          <ellipse cx="80" cy="18" rx="58" ry="5.5" fill="rgba(255,255,255,.07)"/>
          <ellipse cx="58" cy="16" rx="13" ry="4"   fill="rgba(255,255,255,.18)"/>
          <rect x="56" y="48" width="48" height="30" rx="3" fill="rgba(0,0,0,.18)"/>
          <text x="80" y="62" text-anchor="middle" font-family="Georgia,serif" font-size="8"   fill="rgba(255,255,255,.48)" letter-spacing="3.5">ZIPPO</text>
          <text x="80" y="72" text-anchor="middle" font-family="Georgia,serif" font-size="5.5" fill="rgba(255,255,255,.28)" letter-spacing="1.5">EST. 1932</text>
          <rect x="22" y="97" width="116" height="11" rx="2" fill="rgba(80,80,80,.5)"/>
        </g>

        <!-- FLINT WHEEL -->
        <g id="wg">
          <rect x="118" y="108" width="22" height="24" rx="4" fill="#141414" stroke="#444" stroke-width=".8"/>
          <g id="ws" transform="translate(129,120)">
            <circle r="9" fill="none" stroke="#5a5a5a" stroke-width="1.8"/>
            <line x1="-9" y1="0"    x2="9"  y2="0"    stroke="#747474" stroke-width="1.4"/>
            <line x1="0"  y1="-9"   x2="0"  y2="9"    stroke="#747474" stroke-width="1.4"/>
            <line x1="-6.4" y1="-6.4" x2="6.4"  y2="6.4"  stroke="#606060" stroke-width=".9"/>
            <line x1="6.4"  y1="-6.4" x2="-6.4" y2="6.4"  stroke="#606060" stroke-width=".9"/>
            <circle r="3.2" fill="#484848"/><circle r="1.6" fill="#9a9a9a"/>
          </g>
        </g>
      </svg>
    </div><!-- /lc -->

    <!-- Cigarette -->
    <div id="cigrow">
      <div id="cigw">
        <svg width="180" height="36" viewBox="0 0 180 36">
          <defs>
            <linearGradient id="gCP" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%"   stop-color="#f4f1e8"/>
              <stop offset="50%"  stop-color="#eae6d8"/>
              <stop offset="100%" stop-color="#d0ccbe"/>
            </linearGradient>
            <linearGradient id="gCF" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%"   stop-color="#cc7f42"/>
              <stop offset="55%"  stop-color="#9a5c2e"/>
              <stop offset="100%" stop-color="#7a3c18"/>
            </linearGradient>
          </defs>
          <rect x="12" y="10" width="128" height="16" rx="8" fill="url(#gCP)"/>
          <line x1="12" y1="18" x2="140" y2="18" stroke="rgba(0,0,0,.07)" stroke-width=".6"/>
          <rect x="140" y="10" width="30" height="16" rx="5" fill="url(#gCF)"/>
          <rect x="138" y="10" width="4"  height="16" rx="1.5" fill="#b87840" opacity=".9"/>
          <circle cx="15" cy="18" r="8"   fill="#ff3300" opacity=".7"/>
          <circle cx="15" cy="18" r="5"   fill="#ff7700"/>
          <circle cx="15" cy="18" r="2.5" fill="#ffcc00"/>
          <rect x="3" y="13" width="9" height="10" rx="4.5" fill="#888" opacity=".55"/>
        </svg>
      </div>
      <span class="ciglbl">Hold to puff</span>
    </div>

    <div id="hint">Tap lighter or swipe up to open</div>

  </div><!-- /la -->

  <div id="adb">ğŸ“¢ AdMob Banner Slot â€” 320Ã—50</div>

</div><!-- /app -->

<button id="shb" title="Share">ğŸ“¤</button>
<div id="toast"></div>

<!-- STATS PANEL -->
<div id="stpanel" class="panel">
  <div class="pc">
    <div class="pt">âš¡ STATS</div>
    <button class="pclose" id="stClose">âœ•</button>
    <div class="srow"><span class="slbl">Lit Today</span>       <span class="sval" id="spTd">0</span></div>
    <div class="srow"><span class="slbl">All Time</span>        <span class="sval" id="spTt">0</span></div>
    <div class="srow"><span class="slbl">Best Streak</span>     <span class="sval" id="spSt">0 ğŸ”¥</span></div>
    <div class="srow"><span class="slbl">Puffs Taken</span>     <span class="sval" id="spPu">0</span></div>
    <div class="srow"><span class="slbl">Concert Sessions</span><span class="sval" id="spCo">0</span></div>
    <div class="brow">
      <button class="btn bdan" id="rstBtn">Reset Stats</button>
      <button class="btn bpri" onclick="alert('Remove Ads Forever â€” $2.99\nComing soon!')">No Ads â€” $2.99</button>
    </div>
  </div>
</div>

<!-- SETTINGS PANEL -->
<div id="setPanelEl" class="panel">
  <div class="pc">
    <div class="pt">ğŸ¨ SKINS &amp; SETTINGS</div>
    <button class="pclose" id="setClose">âœ•</button>
    <div class="skcard">
      <div class="skprev" style="background:linear-gradient(135deg,#c0c0c0,#808080,#e8e8e8,#606060)"></div>
      <div class="skinfo"><div class="sn">Classic Chrome</div><div class="sp" style="color:#888">Free Â· Equipped</div></div>
    </div>
    <div class="skcard">
      <div class="skprev" style="background:linear-gradient(135deg,#c9a84c,#7a5c1e,#e8cc6a,#9a7c3a)"></div>
      <div class="skinfo"><div class="sn">Gold Engraved</div><div class="sp">$1.99 Premium</div></div>
      <button class="btn bgld bbuy" onclick="alert('Gold Engraved â€” $1.99\nComing soon!')">Buy</button>
    </div>
    <div class="skcard">
      <div class="skprev" style="background:linear-gradient(135deg,#00ffcc,#0044ff,#ff00cc,#6600ff)"></div>
      <div class="skinfo"><div class="sn">Neon Vape</div><div class="sp">$1.99 Premium</div></div>
      <button class="btn bpri bbuy" onclick="alert('Neon Vape â€” $1.99\nComing soon!')">Buy</button>
    </div>
    <div class="skcard">
      <div class="skprev" style="background:linear-gradient(135deg,#8b0000,#ff4400,#2a0000,#cc2200)"></div>
      <div class="skinfo"><div class="sn">Fantasy Dragon</div><div class="sp">$2.99 Premium</div></div>
      <button class="btn bbuy" style="background:linear-gradient(135deg,#8b0000,#cc2200);color:#fff" onclick="alert('Fantasy Dragon â€” $2.99\nComing soon!')">Buy</button>
    </div>
    <div class="brow" style="margin-top:18px">
      <button class="btn bsec" id="micToggle">ğŸ¤ Blow Detection: OFF</button>
    </div>
    <div class="brow">
      <button class="btn bsec" onclick="alert('Remove Ads Forever â€” $2.99\nComing soon!')">ğŸš« Remove Ads â€” $2.99</button>
    </div>
  </div>
</div>

<!-- MIC PROMPT -->
<div id="mp">
  <div class="mpc">
    <div class="mpi">ğŸ¤</div>
    <div class="mpt">Blow to Intensify</div>
    <div class="mpb">FlickIt listens for you blowing into the microphone â€” the harder you blow, the wilder the flame and smoke get. Allow mic access?</div>
    <div class="brow">
      <button class="btn bsec" id="micDeny">No Thanks</button>
      <button class="btn bpri" id="micAllow">Allow ğŸ”¥</button>
    </div>
  </div>
</div>

<!-- INTERSTITIAL -->
<div id="inter">
  <div class="abox">
    <div class="aico">ğŸ“±</div>
    <div class="atxt">INTERSTITIAL AD SLOT</div>
    <div class="asub">Replace with AdMob / Google Ads SDK</div>
  </div>
  <button id="skipAd">Skip Ad â€º</button>
</div>

<!-- INSTALL BANNER -->
<div id="ib">
  <span class="ibtxt">Add <strong>FlickIt</strong> to your home screen!</span>
  <button id="ibyes">Install</button>
  <button id="ibno">âœ•</button>
</div>

<!-- =====================================================================
     SERVICE WORKER (blob)
     ===================================================================== -->
<script>
if ('serviceWorker' in navigator) {
  var sw = `
const C='fi-v2';
self.addEventListener('install',e=>{e.waitUntil(caches.open(C).then(c=>c.add('/')));self.skipWaiting();});
self.addEventListener('activate',e=>{e.waitUntil(clients.claim());});
self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).catch(()=>r)));});
  `;
  navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw],{type:'application/javascript'}))).catch(function(){});
}
</script>

<!-- =====================================================================
     MAIN APPLICATION
     ===================================================================== -->
<script>
(function(){
'use strict';

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STATE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var S = {
  open:false, lit:false, color:'orange', skin:'chrome',
  concert:false, micOn:false, micAsked:false,
  tX:0, tY:0, micVol:0, puffing:false,
  today:0, total:0, streak:0, puffs:0, concerts:0,
  iCount:0, lastDate:''
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PERSISTENCE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function loadS(){
  try{
    var d=JSON.parse(localStorage.getItem('fi3')||'{}');
    var td=new Date().toDateString();
    S.total   =d.total   ||0;
    S.streak  =d.streak  ||0;
    S.puffs   =d.puffs   ||0;
    S.concerts=d.concerts||0;
    S.lastDate=d.lastDate||'';
    S.today   =(d.lastDate===td)?(d.today||0):0;
  }catch(e){}
}
function saveS(){
  try{
    localStorage.setItem('fi3',JSON.stringify({
      total:S.total,streak:S.streak,puffs:S.puffs,
      concerts:S.concerts,today:S.today,lastDate:new Date().toDateString()
    }));
  }catch(e){}
}
loadS();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   DOM SHORTCUTS
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function g(id){return document.getElementById(id);}

var canvas   = g('fc');
var cx       = canvas.getContext('2d');
var lcEl     = g('lc');
var lidEl    = g('lid');
var wsEl     = g('ws');
var wgEl     = g('wg');
var cigRow   = g('cigrow');
var cigW     = g('cigw');
var hintEl   = g('hint');
var concO    = g('co2');
var conBtn   = g('conBtn');

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CANVAS RESIZE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
resize();
window.addEventListener('resize',resize);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HAPTIC
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function hap(p){if(navigator.vibrate)navigator.vibrate(p);}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TOAST
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _tt=null;
function toast(m){
  var el=g('toast');
  el.textContent=m; el.classList.add('show');
  clearTimeout(_tt);
  _tt=setTimeout(function(){el.classList.remove('show');},2700);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   COUNTER UI + bump animation
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function bump(id){
  var el=g(id);
  el.classList.remove('bump');
  void el.offsetWidth;
  el.classList.add('bump');
  setTimeout(function(){el.classList.remove('bump');},260);
}
function updateUI(){
  g('ctd').textContent=S.today;
  g('ctt').textContent=S.total;
  g('cts').textContent=S.streak;
  g('spTd').textContent=S.today;
  g('spTt').textContent=S.total;
  g('spSt').textContent=S.streak+' ğŸ”¥';
  g('spPu').textContent=S.puffs;
  g('spCo').textContent=S.concerts;
}
updateUI();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HINT
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setHint(m){
  hintEl.style.opacity='0';
  setTimeout(function(){hintEl.textContent=m;hintEl.style.opacity='1';},160);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   AUDIO (procedural â€” zero external files)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _actx=null;
function ac(){
  if(!_actx)_actx=new(window.AudioContext||window.webkitAudioContext)();
  if(_actx.state==='suspended')_actx.resume();
  return _actx;
}
function noiseBuf(dur){
  var ctx=ac();
  var b=ctx.createBuffer(1,Math.floor(ctx.sampleRate*dur),ctx.sampleRate);
  var d=b.getChannelData(0);
  for(var i=0;i<d.length;i++)d[i]=Math.random()*2-1;
  return b;
}
function playClick(){
  try{
    var ctx=ac(),b=noiseBuf(0.07),d=b.getChannelData(0);
    for(var i=0;i<d.length;i++)d[i]*=Math.exp(-i/(ctx.sampleRate*0.012));
    var s=ctx.createBufferSource(),gn=ctx.createGain();
    s.buffer=b;gn.gain.value=0.55;
    s.connect(gn);gn.connect(ctx.destination);s.start();
  }catch(e){}
}
function playSpark(){
  try{
    var ctx=ac(),sr=ctx.sampleRate,b=noiseBuf(0.13),d=b.getChannelData(0);
    for(var i=0;i<d.length;i++){
      var t=i/sr;
      d[i]=d[i]*Math.exp(-t*28)+Math.sin(2*Math.PI*3500*t)*Math.exp(-t*45)*0.25;
    }
    var s=ctx.createBufferSource(),gn=ctx.createGain();
    s.buffer=b;gn.gain.value=0.5;
    s.connect(gn);gn.connect(ctx.destination);s.start();
  }catch(e){}
}
function playFlame(){
  try{
    var ctx=ac(),b=noiseBuf(2.0),s=ctx.createBufferSource();
    var bpf=ctx.createBiquadFilter();
    bpf.type='bandpass';bpf.frequency.value=380;bpf.Q.value=0.75;
    var gn=ctx.createGain(),now=ctx.currentTime;
    gn.gain.setValueAtTime(0,now);
    gn.gain.linearRampToValueAtTime(0.22,now+0.12);
    gn.gain.linearRampToValueAtTime(0.14,now+2.0);
    s.buffer=b;s.connect(bpf);bpf.connect(gn);gn.connect(ctx.destination);
    s.start();s.stop(now+2.0);
  }catch(e){}
}
function playPuff(){
  try{
    var ctx=ac(),sr=ctx.sampleRate,b=noiseBuf(0.45),d=b.getChannelData(0);
    for(var i=0;i<d.length;i++){var t=i/sr;d[i]=d[i]*Math.sin(Math.PI*t/0.45)*0.45;}
    var s=ctx.createBufferSource(),lpf=ctx.createBiquadFilter(),gn=ctx.createGain();
    lpf.type='lowpass';lpf.frequency.value=750;gn.gain.value=0.38;
    s.buffer=b;s.connect(lpf);lpf.connect(gn);gn.connect(ctx.destination);s.start();
  }catch(e){}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   MICROPHONE â€” very sensitive (64 bins, threshold /55)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _mstr=null,_man=null,_mdat=null,_mraf=null;

function startMic(){
  navigator.mediaDevices.getUserMedia({audio:true,video:false})
  .then(function(stream){
    _mstr=stream;
    var actx=ac(),src=actx.createMediaStreamSource(stream);
    _man=actx.createAnalyser();
    _man.fftSize=256;                     // 128 bins total
    _man.smoothingTimeConstant=0.45;
    _mdat=new Uint8Array(_man.frequencyBinCount);
    src.connect(_man);
    S.micOn=true;
    g('micToggle').textContent='ğŸ¤ Blow Detection: ON âœ…';
    toast('ğŸ¤ ON â€” blow hard into mic to intensify flame! ğŸ’¨');
    function rd(){
      _man.getByteFrequencyData(_mdat);
      // Use first 64 bins = broadband low-freq blow noise
      var sum=0,bins=Math.min(64,_mdat.length);
      for(var i=0;i<bins;i++)sum+=_mdat[i];
      // Very low threshold: /55 â†’ reacts to gentle blowing
      S.micVol=Math.min(sum/bins/55,1.0);
      _mraf=requestAnimationFrame(rd);
    }
    rd();
  })
  .catch(function(){toast('Mic access denied â€” check browser settings');});
}
function stopMic(){
  if(_mstr){_mstr.getTracks().forEach(function(t){t.stop();});_mstr=null;}
  if(_mraf){cancelAnimationFrame(_mraf);_mraf=null;}
  S.micOn=false;S.micVol=0;
  g('micToggle').textContent='ğŸ¤ Blow Detection: OFF';
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   DEVICE MOTION (shake)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _lacc={x:0,y:0,z:0},_lshk=0;
function onMotion(e){
  var a=e.accelerationIncludingGravity||e.acceleration;
  if(!a)return;
  var dx=Math.abs((a.x||0)-_lacc.x),dy=Math.abs((a.y||0)-_lacc.y),dz=Math.abs((a.z||0)-_lacc.z);
  _lacc={x:a.x||0,y:a.y||0,z:a.z||0};
  var mag=Math.sqrt(dx*dx+dy*dy+dz*dz),now=Date.now();
  if(mag>16&&now-_lshk>700){
    _lshk=now;
    if(!S.open) openLid();
    else if(!S.lit){playSpark();showSpark();setTimeout(ignite,180);}
  }
}
function onOrient(e){
  var g2=e.gamma||0,b=(e.beta||0)-45;
  S.tX=Math.max(-1,Math.min(1,g2/90));
  S.tY=Math.max(-1,Math.min(1,b/90));
}
function initMotion(){
  if(typeof DeviceMotionEvent!=='undefined'&&typeof DeviceMotionEvent.requestPermission==='function'){
    // iOS 13+ â€” attach on first user gesture
    document.addEventListener('click',function rp(){
      DeviceMotionEvent.requestPermission().then(function(p){
        if(p==='granted'){
          window.addEventListener('devicemotion',onMotion);
          window.addEventListener('deviceorientation',onOrient);
        }
      }).catch(function(){});
      document.removeEventListener('click',rp);
    },{once:true});
  } else {
    window.addEventListener('devicemotion',onMotion);
    window.addEventListener('deviceorientation',onOrient);
  }
}
initMotion();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LID / IGNITION
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _fAlpha=0;

function openLid(){
  if(S.open)return;
  S.open=true;
  lidEl.classList.add('open');
  playClick();hap(30);
  setHint('Flick the wheel or tap again to ignite ğŸ”¥');
}
function closeLid(){
  if(!S.open)return;
  if(S.lit)extinguish();
  S.open=false;
  lidEl.classList.remove('open');
  playClick();hap(20);
  setHint('Tap lighter or swipe up to open');
}
function ignite(){
  if(S.lit||!S.open)return;
  S.lit=true;_fAlpha=0;
  lcEl.classList.add('glow');
  playFlame();hap([20,30,60]);
  S.today++;S.total++;
  if(S.streak<S.total)S.streak++;
  saveS();updateUI();
  bump('ctd');bump('ctt');
  cigRow.classList.add('vis');
  setHint('Tilt to sway flame Â· Blow for wild fire ğŸŒ¬ï¸');
  S.iCount++;
  if(S.iCount%5===0)setTimeout(showInter,1800);
  if(!S.micAsked){
    S.micAsked=true;
    setTimeout(function(){if(!S.micOn)g('mp').classList.add('open');},1600);
  }
}
function extinguish(){
  if(!S.lit)return;
  S.lit=false;_fAlpha=0;
  lcEl.classList.remove('glow');
  parts.length=0;
  cigRow.classList.remove('vis');
  S.puffing=false;
  setHint(S.open?'Flick the wheel to ignite ğŸ”¥':'Tap lighter or swipe up to open');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SPARK FX
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showSpark(){
  var sp=document.createElement('div');
  sp.className='sfx';sp.textContent='âœ¦';
  lcEl.appendChild(sp);
  setTimeout(function(){sp.remove();},450);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   WHEEL EVENTS
   Separate touchstart/touchmove/touchend with preventDefault
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _wa=0,_wty=null,_wdelta=0;

wgEl.addEventListener('touchstart',function(e){
  e.stopPropagation();e.preventDefault();
  _wty=e.touches[0].clientY;_wdelta=0;
},{passive:false});

wgEl.addEventListener('touchmove',function(e){
  if(_wty===null)return;
  e.stopPropagation();e.preventDefault();
  var dy=_wty-e.touches[0].clientY;
  _wdelta+=Math.abs(dy);
  _wa+=dy*1.1;
  wsEl.setAttribute('transform','translate(11,11) rotate('+_wa+')');
  _wty=e.touches[0].clientY;
},{passive:false});

wgEl.addEventListener('touchend',function(e){
  e.stopPropagation();e.preventDefault();
  if(_wdelta>10){
    playSpark();showSpark();
    if(!S.open)openLid();
    else setTimeout(function(){if(!S.lit)ignite();},190);
  } else if(!S.open){
    openLid();
  } else {
    playSpark();showSpark();
    _wa+=50;wsEl.setAttribute('transform','translate(11,11) rotate('+_wa+')');
    setTimeout(function(){if(!S.lit)ignite();},190);
  }
  _wty=null;_wdelta=0;
},{passive:false});

// Desktop mouse
wgEl.addEventListener('click',function(e){
  e.stopPropagation();
  if(!S.open){openLid();return;}
  playSpark();showSpark();
  _wa+=55;wsEl.setAttribute('transform','translate(11,11) rotate('+_wa+')');
  setTimeout(function(){if(!S.lit)ignite();},190);
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LIGHTER BODY SWIPE & TAP
   KEY FIX: single-finger tracking, preventDefault on all
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _tx0=0,_ty0=0,_tid=null;

lcEl.addEventListener('touchstart',function(e){
  if(_tid!==null)return;          // only first finger
  e.preventDefault();              // CRITICAL: blocks scroll & bounce
  var t=e.changedTouches[0];
  _tid=t.identifier;_tx0=t.clientX;_ty0=t.clientY;
},{passive:false});

lcEl.addEventListener('touchmove',function(e){
  e.preventDefault();              // CRITICAL: blocks scroll while swiping
},{passive:false});

lcEl.addEventListener('touchend',function(e){
  e.preventDefault();
  var found=null;
  for(var i=0;i<e.changedTouches.length;i++){
    if(e.changedTouches[i].identifier===_tid){found=e.changedTouches[i];break;}
  }
  if(!found)return;
  _tid=null;
  var dx=found.clientX-_tx0,dy=found.clientY-_ty0;
  var adx=Math.abs(dx),ady=Math.abs(dy),dist=Math.sqrt(dx*dx+dy*dy);

  if(dist<14){
    // TAP
    if(!S.open)openLid();
    else if(!S.lit)ignite();
    else closeLid();
    return;
  }
  if(ady>adx){
    if(dy<-18){
      // SWIPE UP
      if(!S.open)openLid();
      else if(!S.lit){playSpark();showSpark();setTimeout(ignite,180);}
    } else if(dy>18){
      // SWIPE DOWN
      if(S.open)closeLid();
    }
  }
},{passive:false});

lcEl.addEventListener('touchcancel',function(){_tid=null;},{passive:true});

// Desktop fallback
lcEl.addEventListener('click',function(){
  if(!S.open)openLid();
  else if(!S.lit)ignite();
  else closeLid();
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CIGARETTE PUFFING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _pt=null;
function startPuff(){
  if(!S.lit)return;
  S.puffing=true;playPuff();hap(15);
  clearTimeout(_pt);
  _pt=setTimeout(stopPuff,3500);
}
function stopPuff(){
  if(!S.puffing)return;
  S.puffing=false;S.puffs++;
  saveS();updateUI();
}
cigW.addEventListener('touchstart',function(e){e.preventDefault();startPuff();},{passive:false});
cigW.addEventListener('touchend',  function(e){e.preventDefault();stopPuff(); },{passive:false});
cigW.addEventListener('touchcancel',stopPuff,{passive:true});
cigW.addEventListener('mousedown',startPuff);
document.addEventListener('mouseup',function(){if(S.puffing)stopPuff();});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CONCERT MODE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _craf=null,_cph=0;
function startConcert(){
  S.concert=true;conBtn.classList.add('on');concO.classList.add('on');
  S.concerts++;saveS();updateUI();
  toast('ğŸµ Concert Mode! Raise your lighter ğŸ”¥');
  if(!S.open)openLid();
  setTimeout(function(){if(!S.lit)ignite();},450);
  function loop(){
    _cph+=0.038;
    var r=Math.round(110+Math.sin(_cph*1.2)*55);
    var gr=Math.round(35+Math.sin(_cph*0.65+2)*25);
    var b2=Math.round(75+Math.sin(_cph*1.6+4)*50);
    var a=0.10+Math.abs(Math.sin(_cph))*0.12;
    concO.style.background='rgba('+r+','+gr+','+b2+','+a+')';
    document.documentElement.style.setProperty('--glow','rgba('+r+','+gr+','+b2+',.65)');
    _craf=requestAnimationFrame(loop);
  }
  loop();
}
function stopConcert(){
  S.concert=false;conBtn.classList.remove('on');concO.classList.remove('on');
  concO.style.background='transparent';
  document.documentElement.style.setProperty('--glow','rgba(255,140,30,.55)');
  if(_craf){cancelAnimationFrame(_craf);_craf=null;}
}
conBtn.addEventListener('click',function(){if(S.concert)stopConcert();else startConcert();});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   COLOR PICKER
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var LOCKED_C=new Set(['green','purple','red']);
document.querySelectorAll('.cdot').forEach(function(d){
  d.addEventListener('click',function(){
    var c=d.dataset.c;
    if(LOCKED_C.has(c)){alert(c.charAt(0).toUpperCase()+c.slice(1)+' flame â€” Premium ğŸ”’\nComing soon for $0.99');return;}
    document.querySelectorAll('.cdot').forEach(function(x){x.classList.remove('on');});
    d.classList.add('on');S.color=c;
    toast('Flame: '+c+' ğŸ”¥');
  });
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SKIN SELECTOR
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.querySelectorAll('.st').forEach(function(t){
  t.addEventListener('click',function(){
    if(t.querySelector('.sl')){alert(t.dataset.s+' skin â€” Premium ğŸ”’\nVisit Settings to unlock!');return;}
    document.querySelectorAll('.st').forEach(function(x){x.classList.remove('on');});
    t.classList.add('on');S.skin=t.dataset.s;toast('Skin applied!');
  });
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PANELS
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
g('statBtn').addEventListener('click',function(){updateUI();g('stpanel').classList.add('open');});
g('stClose').addEventListener('click', function(){g('stpanel').classList.remove('open');});
g('setBtn').addEventListener('click',  function(){g('setPanelEl').classList.add('open');});
g('setClose').addEventListener('click',function(){g('setPanelEl').classList.remove('open');});
['stpanel','setPanelEl'].forEach(function(id){
  g(id).addEventListener('click',function(e){if(e.target===e.currentTarget)e.currentTarget.classList.remove('open');});
});
g('rstBtn').addEventListener('click',function(){
  if(!confirm('Reset all stats?'))return;
  S.today=S.total=S.streak=S.puffs=S.concerts=0;
  saveS();updateUI();toast('Stats reset!');
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   MIC PROMPT
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
g('micAllow').addEventListener('click',function(){g('mp').classList.remove('open');startMic();});
g('micDeny').addEventListener('click', function(){g('mp').classList.remove('open');});
g('micToggle').addEventListener('click',function(){
  if(S.micOn){stopMic();toast('ğŸ¤ Blow detection OFF');}
  else{g('setPanelEl').classList.remove('open');setTimeout(function(){g('mp').classList.add('open');},200);}
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   INTERSTITIAL
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showInter(){g('inter').classList.add('open');}
g('skipAd').addEventListener('click',function(){g('inter').classList.remove('open');});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SHARE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
g('shb').addEventListener('click',function(){
  var msg='ğŸ”¥ I\'ve lit '+S.total+' virtual lighters with FlickIt! Streak: '+S.streak+' ğŸ”¥\n'+location.href;
  if(navigator.share){navigator.share({title:'FlickIt',text:msg,url:location.href}).catch(function(){});}
  else if(navigator.clipboard){navigator.clipboard.writeText(msg).then(function(){toast('Copied! Share it ğŸ“‹');});}
  else{toast('Share: '+location.href);}
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PWA INSTALL PROMPT
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var _dip=null;
window.addEventListener('beforeinstallprompt',function(e){
  e.preventDefault();_dip=e;g('ib').classList.add('show');
});
g('ibyes').addEventListener('click',function(){if(_dip){_dip.prompt();_dip=null;}g('ib').classList.remove('show');});
g('ibno').addEventListener('click', function(){g('ib').classList.remove('show');});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   KEYBOARD SHORTCUTS (desktop)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('keydown',function(e){
  if(e.code==='Space'){e.preventDefault();if(!S.open)openLid();else if(!S.lit)ignite();else closeLid();}
  if(e.code==='Escape')closeLid();
  if(e.code==='KeyC'){if(S.concert)stopConcert();else startConcert();}
  if(e.code==='KeyM')g('micToggle').click();
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PARTICLE SYSTEM
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var PAL={
  orange:{c:['#ff4400','#ff7700','#ffaa00','#ffcc22','#ff2200'],in:'#fffae0',bl:'#3355ff'},
  blue:  {c:['#1133cc','#2255ff','#5599ff','#88ccff','#0022aa'],in:'#eef8ff',bl:'#000088'},
  green: {c:['#006600','#00aa33','#44dd22','#aaff44','#004400'],in:'#f0ffe0',bl:'#003300'},
  purple:{c:['#6600cc','#9922ff','#cc66ff','#ee99ff','#440099'],in:'#fceeff',bl:'#220055'},
  red:   {c:['#990000','#cc2200','#ff3300','#ff6600','#880000'],in:'#fff5f5',bl:'#440000'}
};

var parts=[];
var smokes=[];
var MAX_P=80,MAX_S=40;

function Particle(ox,oy){this.init(ox,oy);}
Particle.prototype.init=function(ox,oy){
  var pal=PAL[S.color],inten=1+S.micVol*2.5;
  this.x=ox+(Math.random()-.5)*18;
  this.y=oy;
  this.vx=(Math.random()-.5)*1.4+S.tX*1.1;
  this.vy=-(2.8+Math.random()*3.0)*inten;
  this.life=1.0;
  this.size=9+Math.random()*22;
  this.isCore =Math.random()<0.12;
  this.isBlue =Math.random()<0.22&&!this.isCore;
  var ci=Math.floor(Math.random()*pal.c.length);
  this.col=this.isBlue?pal.bl:(this.isCore?pal.in:pal.c[ci]);
  if(this.isBlue)this.size*=0.5;
  if(this.isCore)this.size*=0.4;
  // random decay = organic flicker
  this.decay=0.014+Math.random()*0.018;
};

function Smoke(ox,oy){
  var spd=S.puffing?(0.9+S.micVol*3.5):0.4;
  this.x=ox+(Math.random()-.5)*12;this.y=oy;
  this.vx=(Math.random()-.5)*0.7+S.tX*0.3;
  this.vy=-(0.5+Math.random()*0.9)*spd;
  this.life=1.0;this.size=7+Math.random()*12;
  this.grow=0.14+Math.random()*0.2;
  this.alpha=0;this.decay=0.004+Math.random()*0.004;
  this.fi=true;
}

function flameOrigin(){
  var r=lcEl.getBoundingClientRect();
  return{x:r.left+r.width*(80/160),y:r.top+r.height*(88/280)};
}
function cigTip(){
  if(!S.lit)return null;
  var sv=cigW.querySelector('svg');if(!sv)return null;
  var r=sv.getBoundingClientRect();
  return{x:r.left+r.width*(15/180),y:r.top+r.height*0.5};
}

function spawnFlame(ox,oy){
  var rate=3+Math.floor(S.micVol*8);// more particles when blowing
  for(var i=0;i<rate;i++){
    if(parts.length<MAX_P){parts.push(new Particle(ox,oy));}
    else{parts[0].init(ox,oy);parts.push(parts.shift());}
  }
}
function spawnSmoke(ox,oy){if(smokes.length<MAX_S)smokes.push(new Smoke(ox,oy));}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RENDER LOOP
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function loop(){
  requestAnimationFrame(loop);
  cx.clearRect(0,0,canvas.width,canvas.height);
  if(!S.lit&&parts.length===0&&smokes.length===0)return;

  var o=flameOrigin();

  // Fade flame alpha
  if(S.lit) _fAlpha=Math.min(_fAlpha+0.07,1);
  else       _fAlpha=Math.max(_fAlpha-0.10,0);

  // Spawn flame
  if(S.lit&&_fAlpha>0.2) spawnFlame(o.x,o.y);

  // Draw flame particles
  for(var i=parts.length-1;i>=0;i--){
    var p=parts[i];
    p.life-=p.decay+Math.random()*0.004;
    if(p.life<=0){parts.splice(i,1);continue;}
    p.vx+=S.tX*0.20+(Math.random()-.5)*0.07;
    p.vy*=0.972;
    p.x+=p.vx;p.y+=p.vy;
    p.size*=0.970;
    if(p.size<1){parts.splice(i,1);continue;}
    cx.save();
    cx.globalAlpha=p.life*_fAlpha*0.88;
    var gr=cx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.size);
    gr.addColorStop(0.0,p.col);
    gr.addColorStop(0.45,p.col);
    gr.addColorStop(1.0,'rgba(0,0,0,0)');
    cx.fillStyle=gr;
    cx.beginPath();cx.arc(p.x,p.y,p.size,0,Math.PI*2);cx.fill();
    cx.restore();
  }

  // Glow pool at base
  if(_fAlpha>0.05){
    var pal2=PAL[S.color];
    cx.save();
    cx.globalAlpha=_fAlpha*(0.33+S.micVol*0.22);
    var gRadius=60+S.micVol*28;
    var gg=cx.createRadialGradient(o.x,o.y,0,o.x,o.y,gRadius);
    gg.addColorStop(0.0,pal2.c[0]);
    gg.addColorStop(0.5,'rgba(255,80,0,.2)');
    gg.addColorStop(1.0,'rgba(0,0,0,0)');
    cx.fillStyle=gg;
    cx.beginPath();cx.arc(o.x,o.y,gRadius,0,Math.PI*2);cx.fill();
    cx.restore();
  }

  // Cigarette smoke
  var ct=cigTip();
  if(ct){
    if(S.puffing||S.micVol>0.15){spawnSmoke(ct.x,ct.y);spawnSmoke(ct.x,ct.y);}
    if(S.lit&&Math.random()<0.35)spawnSmoke(ct.x,ct.y-4);
  }

  // Draw smoke
  for(var j=smokes.length-1;j>=0;j--){
    var s=smokes[j];
    s.life-=s.decay;
    if(s.life<=0){smokes.splice(j,1);continue;}
    s.vx+=(Math.random()-.5)*0.07+S.tX*0.04;
    s.vy*=0.993;
    s.x+=s.vx;s.y+=s.vy;s.size+=s.grow;
    if(s.fi){s.alpha+=0.022;if(s.alpha>=0.28)s.fi=false;}
    else{s.alpha=Math.min(s.alpha,s.life*0.38);}
    cx.save();
    cx.globalAlpha=Math.max(0,s.alpha);
    var sg=cx.createRadialGradient(s.x,s.y,0,s.x,s.y,s.size);
    sg.addColorStop(0,'rgba(210,210,210,.55)');
    sg.addColorStop(.55,'rgba(160,160,160,.28)');
    sg.addColorStop(1,'rgba(100,100,100,0)');
    cx.fillStyle=sg;cx.beginPath();cx.arc(s.x,s.y,s.size,0,Math.PI*2);cx.fill();
    cx.restore();
  }
}
loop();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GLOBAL TOUCH PREVENTION
   Stops pull-to-refresh, scroll bounce, and zoom globally.
   Panel cards are allowed to scroll via passive touchmove inside them.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('touchmove',function(e){
  // Allow touch-move inside scrollable panel cards only
  if(e.target.closest&&e.target.closest('.pc'))return;
  e.preventDefault();
},{passive:false});

document.addEventListener('touchstart',function(e){
  // Only block native behaviours outside panel cards
  if(e.target.closest&&e.target.closest('.pc'))return;
  // Don't call preventDefault here â€” individual element handlers do it
  // This prevents double-firing but still allows button taps
},{passive:true});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   INIT
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
setHint('Tap lighter or swipe up to open');
setTimeout(function(){toast('Welcome to FlickIt! ğŸ”¥ Tap to begin');},800);

})();
</script>
</body>
</html>
